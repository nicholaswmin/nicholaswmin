<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="color-scheme" content="dark light">
	<meta name="description" content="a blog site">
	<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><text x='0' y='14'>🚜</text></svg>" />
	<link href="/index.rss" type="application/rss+xml" 
	rel="alternate" title="RSS feed for blog posts" />
	<link rel="stylesheet" href="/public/style.css">
</head> 

<title>Blog Index</title>

<nav id="top">
	<a href="/">posts</a>
</nav>

<main class="post">
<p><a href="https://github.com/nicholaswmin/fsm/actions/workflows/tests:unit.yml"><img src="https://github.com/nicholaswmin/fsm/actions/workflows/tests:unit.yml/badge.svg" alt="tests" /></a> <a href="#tests"><img src="https://img.shields.io/badge/coverage-%3E%2095%25-blue" alt="ccovt" /></a></p>

<h1 id="fsm">fsm</h1>

<blockquote>
  <p>A <a href="https://en.wikipedia.org/wiki/Finite-state_machine">finite-state machine</a></p>

  <p>… is an abstract machine that can be in one of a finite number of states.    <br />
The change from one <code>state</code> to another is called a <code>transition</code>.</p>
</blockquote>

<p>This package constructs simple FSM’s which express their logic <br />
declaratively &amp; safely.<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup></p>

<p><code>~1KB</code>, zero dependencies, <a href="https://github.com/nicholaswmin/fsm/blob/main/.github/CONTRIBUTING.md#design-goals">opinionated</a></p>

<h3 id="basic">Basic</h3>

<ul>
  <li><a href="#install">Install</a></li>
  <li><a href="#example">Example</a>
    <ul>
      <li><a href="#initialisation">Initialisation</a></li>
      <li><a href="#transition">Transition</a></li>
      <li><a href="#current-state">Current state</a></li>
    </ul>
  </li>
</ul>

<h3 id="extras">Extras</h3>

<ul>
  <li><a href="#hook-methods">Hooks</a></li>
  <li><a href="#transition-cancellations">Transition cancellations</a></li>
  <li><a href="#asynchronous-transitions">Asynchronous transitions</a></li>
  <li><a href="#serialising-to-json">Serialising to JSON</a></li>
  <li><a href="#fsm-as-a-mixin">As a mixin</a></li>
</ul>

<h3 id="api">API</h3>

<ul>
  <li><a href="#fsmstates-hooks"><code>fsm(states, hooks)</code></a></li>
  <li><a href="#fsmjson-hooks"><code>fsm(json, hooks)</code></a></li>
  <li><a href="#fsmstate"><code>fsm.state</code></a></li>
</ul>

<h3 id="meta">Meta</h3>

<ul>
  <li><a href="#tests">Tests</a></li>
  <li><a href="#publishing">Publishing</a></li>
  <li><a href="#authors">Authors</a></li>
  <li><a href="#license">License</a></li>
</ul>

<h2 id="install">Install</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i @nicholaswmin/fsm
</code></pre></div></div>

<h2 id="example">Example</h2>

<blockquote>
  <p>A <a href="https://en.wikipedia.org/wiki/Finite-state_machine#Example:_coin-operated_turnstile">turnstile</a> gate that opens with a <code>coin</code>.  <br />
When opened you can push through it; after which it closes again:</p>
</blockquote>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">fsm</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@nicholaswmin/fsm</span><span class="dl">'</span>

<span class="c1">// define states &amp; transitions:</span>

<span class="kd">const</span> <span class="nx">turnstile</span> <span class="o">=</span> <span class="nf">fsm</span><span class="p">({</span>
  <span class="na">closed</span><span class="p">:</span> <span class="p">{</span> <span class="na">coin</span><span class="p">:</span> <span class="dl">'</span><span class="s1">opened</span><span class="dl">'</span> <span class="p">},</span>
  <span class="na">opened</span><span class="p">:</span> <span class="p">{</span> <span class="na">push</span><span class="p">:</span> <span class="dl">'</span><span class="s1">closed</span><span class="dl">'</span> <span class="p">}</span>
<span class="p">})</span>

<span class="c1">// transition: coin</span>
<span class="nx">turnstile</span><span class="p">.</span><span class="nf">coin</span><span class="p">()</span>
<span class="c1">// state: opened</span>

<span class="c1">// transition: push</span>
<span class="nx">turnstile</span><span class="p">.</span><span class="nf">push</span><span class="p">()</span>
<span class="c1">// state: closed</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">turnstile</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span>
<span class="c1">// "closed"</span>
</code></pre></div></div>

<p>Each step is broken down below.</p>

<h2 id="initialisation">Initialisation</h2>

<p>An FSM with 2 possible <code>states</code>, each listing a single <code>transition</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">turnstile</span> <span class="o">=</span> <span class="nf">fsm</span><span class="p">({</span>
  <span class="na">closed</span><span class="p">:</span> <span class="p">{</span> <span class="na">coin</span><span class="p">:</span> <span class="dl">'</span><span class="s1">opened</span><span class="dl">'</span> <span class="p">},</span>
  <span class="na">opened</span><span class="p">:</span> <span class="p">{</span> <span class="na">push</span><span class="p">:</span> <span class="dl">'</span><span class="s1">closed</span><span class="dl">'</span> <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<ul>
  <li><code>state: closed</code>: allows <code>transition: coin</code> which sets: <code>state: opened</code></li>
  <li><code>state: opened</code>: allows <code>transition: push</code> which sets: <code>state: closed</code></li>
</ul>

<h2 id="transition">Transition</h2>

<p>A <code>transition</code> can be called as a method:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">turnstile</span> <span class="o">=</span> <span class="nf">fsm</span><span class="p">({</span>
  <span class="c1">// defined 'coin' transition</span>
  <span class="na">closed</span><span class="p">:</span> <span class="p">{</span> <span class="na">coin</span><span class="p">:</span> <span class="dl">'</span><span class="s1">opened</span><span class="dl">'</span> <span class="p">},</span>

  <span class="c1">// defined 'push' transition</span>
  <span class="na">opened</span><span class="p">:</span> <span class="p">{</span> <span class="na">push</span><span class="p">:</span> <span class="dl">'</span><span class="s1">closed</span><span class="dl">'</span> <span class="p">}</span>
<span class="p">})</span>

<span class="nx">turnstile</span><span class="p">.</span><span class="nf">coin</span><span class="p">()</span>
<span class="c1">// state: opened</span>

<span class="nx">turnstile</span><span class="p">.</span><span class="nf">push</span><span class="p">()</span>
<span class="c1">// state: closed</span>
</code></pre></div></div>

<p>The current <code>state</code> must list the transition, otherwise an <code>Error</code> is thrown:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">turnstile</span> <span class="o">=</span> <span class="nf">fsm</span><span class="p">({</span>
  <span class="na">closed</span><span class="p">:</span> <span class="p">{</span> <span class="na">coin</span><span class="p">:</span> <span class="dl">'</span><span class="s1">opened</span><span class="dl">'</span> <span class="p">},</span>
  <span class="na">opened</span><span class="p">:</span> <span class="p">{</span> <span class="na">push</span><span class="p">:</span> <span class="dl">'</span><span class="s1">closed</span><span class="dl">'</span> <span class="p">}</span>
<span class="p">})</span>

<span class="nx">turnstile</span><span class="p">.</span><span class="nf">push</span><span class="p">()</span>
<span class="c1">// TransitionError: </span>
<span class="c1">// current state: "closed" has no transition: "push"</span>
</code></pre></div></div>

<h2 id="current-state">Current state</h2>

<p>The <code>fsm.state</code> property indicates the current <code>state</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">turnstile</span> <span class="o">=</span> <span class="nf">fsm</span><span class="p">({</span>
  <span class="na">closed</span><span class="p">:</span> <span class="p">{</span> <span class="na">foo</span><span class="p">:</span> <span class="dl">'</span><span class="s1">opened</span><span class="dl">'</span> <span class="p">},</span>
  <span class="na">opened</span><span class="p">:</span> <span class="p">{</span> <span class="na">bar</span><span class="p">:</span> <span class="dl">'</span><span class="s1">closed</span><span class="dl">'</span> <span class="p">}</span>
<span class="p">})</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">turnstile</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span>
<span class="c1">// "closed"</span>
</code></pre></div></div>

<h2 id="hook-methods">Hook methods</h2>

<p>Hooks are optional methods, called at specific transition phases.</p>

<p>They must be set as <code>hooks</code> methods; an <code>Object</code> passed as 2nd argument of <br />
<code>fsm(states, hooks)</code>.</p>

<h3 id="transition-hooks">Transition hooks</h3>

<p>Called <em>before</em> the state is changed &amp; can optionally <br />
<a href="#transition-cancellations">cancel a transition</a>.</p>

<p>Must be named: <code>on&lt;transition-name&gt;</code>, where <code>&lt;transition-name&gt;</code> is an actual <br />
<code>transition</code> name.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">turnstile</span> <span class="o">=</span> <span class="nf">fsm</span><span class="p">({</span>
  <span class="na">closed</span><span class="p">:</span> <span class="p">{</span> <span class="na">coin</span><span class="p">:</span> <span class="dl">'</span><span class="s1">opened</span><span class="dl">'</span> <span class="p">},</span>
  <span class="na">opened</span><span class="p">:</span> <span class="p">{</span> <span class="na">push</span><span class="p">:</span> <span class="dl">'</span><span class="s1">closed</span><span class="dl">'</span> <span class="p">}</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="na">onCoin</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">got a coin</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">},</span>
  
  <span class="na">onPush</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">got pushed</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="nx">turnstile</span><span class="p">.</span><span class="nf">coin</span><span class="p">()</span>
<span class="c1">// "got a coin"</span>

<span class="nx">turnstile</span><span class="p">.</span><span class="nf">push</span><span class="p">()</span>
<span class="c1">// "got pushed"</span>
</code></pre></div></div>

<h3 id="state-hooks">State hooks</h3>

<p>Called <em>after</em> the state is changed.</p>

<p>Must be named: <code>on&lt;state-name&gt;</code>, where <code>&lt;state-name&gt;</code> is an actual <code>state</code> name.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">turnstile</span> <span class="o">=</span> <span class="nf">fsm</span><span class="p">({</span>
  <span class="na">closed</span><span class="p">:</span> <span class="p">{</span> <span class="na">coin</span><span class="p">:</span> <span class="dl">'</span><span class="s1">opened</span><span class="dl">'</span> <span class="p">},</span>
  <span class="na">opened</span><span class="p">:</span> <span class="p">{</span> <span class="na">push</span><span class="p">:</span> <span class="dl">'</span><span class="s1">closed</span><span class="dl">'</span> <span class="p">}</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="na">onOpened</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">its open</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">},</span>

  <span class="na">onClosed</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">its closed</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="nx">turnstile</span><span class="p">.</span><span class="nf">coin</span><span class="p">()</span>
<span class="c1">// "its open"</span>

<span class="nx">turnstile</span><span class="p">.</span><span class="nf">push</span><span class="p">()</span>
<span class="c1">// "its closed"</span>
</code></pre></div></div>

<h3 id="hook-arguments">Hook arguments</h3>

<p>Transition methods can pass arguments to relevant hooks, assumed to be<br />
variadic: <sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">turnstile</span> <span class="o">=</span> <span class="nf">fsm</span><span class="p">({</span>
  <span class="na">closed</span><span class="p">:</span> <span class="p">{</span> <span class="na">coin</span><span class="p">:</span> <span class="dl">'</span><span class="s1">opened</span><span class="dl">'</span> <span class="p">},</span>
  <span class="na">opened</span><span class="p">:</span> <span class="p">{</span> <span class="na">push</span><span class="p">:</span> <span class="dl">'</span><span class="s1">closed</span><span class="dl">'</span> <span class="p">}</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nf">onCoin</span><span class="p">(</span><span class="nx">one</span><span class="p">,</span> <span class="nx">two</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">one</span><span class="p">,</span> <span class="nx">two</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="nx">turnstile</span><span class="p">.</span><span class="nf">coin</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">)</span>
<span class="c1">// foo, bar</span>
</code></pre></div></div>

<h2 id="transition-cancellations">Transition cancellations</h2>

<p><a href="#transition-hooks">Transition hooks</a> can cancel the transition by returning <br />
<code>false</code>.</p>

<p>Cancelled transitions don’t change the <em>state</em> nor call any <br />
<a href="#state-hooks">state hooks</a>.</p>

<blockquote>
  <p>example: cancel transition to <code>state: opened</code> if the coin is less than <code>50c</code></p>
</blockquote>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">turnstile</span> <span class="o">=</span> <span class="nf">fsm</span><span class="p">({</span>
  <span class="na">closed</span><span class="p">:</span> <span class="p">{</span> <span class="na">coin</span><span class="p">:</span> <span class="dl">'</span><span class="s1">opened</span><span class="dl">'</span> <span class="p">},</span>
  <span class="na">opened</span><span class="p">:</span> <span class="p">{</span> <span class="na">push</span><span class="p">:</span> <span class="dl">'</span><span class="s1">closed</span><span class="dl">'</span> <span class="p">}</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="nf">onCoin</span><span class="p">(</span><span class="nx">coin</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">coin</span> <span class="o">&gt;=</span> <span class="mi">50</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="nx">turnstile</span><span class="p">.</span><span class="nf">coin</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="c1">// state: closed</span>

<span class="c1">// state still "closed",</span>

<span class="c1">// add more money?</span>

<span class="nx">turnstile</span><span class="p">.</span><span class="nf">coin</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="c1">// state: opened</span>
</code></pre></div></div>

<blockquote>
  <p>note: must explicitly return <code>false</code>, not just <a href="https://developer.mozilla.org/en-US/docs/Glossary/Falsy"><code>falsy</code></a>.</p>
</blockquote>

<h2 id="asynchronous-transitions">Asynchronous transitions</h2>

<p>Mark relevant hooks as <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function"><code>async</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await"><code>await</code></a> the transition:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">turnstile</span> <span class="o">=</span> <span class="nf">fsm</span><span class="p">({</span>
  <span class="na">closed</span><span class="p">:</span> <span class="p">{</span> <span class="na">coin</span><span class="p">:</span> <span class="dl">'</span><span class="s1">opened</span><span class="dl">'</span> <span class="p">},</span>
  <span class="na">opened</span><span class="p">:</span> <span class="p">{</span> <span class="na">push</span><span class="p">:</span> <span class="dl">'</span><span class="s1">closed</span><span class="dl">'</span> <span class="p">}</span>
<span class="p">},</span> <span class="p">{</span>
  <span class="k">async</span> <span class="nf">onCoin</span><span class="p">(</span><span class="nx">coins</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// simulate something async</span>
    <span class="k">await</span> <span class="k">new</span> <span class="nc">Promise</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="nf">setTimeout</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span> <span class="mi">2000</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="k">await</span> <span class="nx">turnstile</span><span class="p">.</span><span class="nf">coin</span><span class="p">()</span>
<span class="c1">// 2 seconds pass ...</span>

<span class="c1">// state: opened</span>
</code></pre></div></div>

<h2 id="serialising-to-json">Serialising to JSON</h2>

<p>Simply use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify"><code>JSON.stringify</code></a>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">hooks</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nf">onCoin</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">got a coin</span><span class="dl">'</span><span class="p">)</span> <span class="p">}</span>
  <span class="nf">onPush</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">pushed ...</span><span class="dl">'</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">turnstile</span> <span class="o">=</span> <span class="nf">fsm</span><span class="p">({</span>
  <span class="na">closed</span><span class="p">:</span> <span class="p">{</span> <span class="na">coin</span><span class="p">:</span> <span class="dl">'</span><span class="s1">opened</span><span class="dl">'</span> <span class="p">},</span>
  <span class="na">opened</span><span class="p">:</span> <span class="p">{</span> <span class="na">push</span><span class="p">:</span> <span class="dl">'</span><span class="s1">closed</span><span class="dl">'</span> <span class="p">}</span>
<span class="p">},</span> <span class="nx">hooks</span><span class="p">)</span>

<span class="nx">turnstile</span><span class="p">.</span><span class="nf">coin</span><span class="p">()</span>
<span class="c1">// got a coin</span>

<span class="kd">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">turnstile</span><span class="p">)</span>
</code></pre></div></div>

<p>… then revive with:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">revived</span> <span class="o">=</span> <span class="nf">fsm</span><span class="p">(</span><span class="nx">json</span><span class="p">,</span> <span class="nx">hooks</span><span class="p">)</span>
<span class="c1">// state: opened </span>

<span class="nx">revived</span><span class="p">.</span><span class="nf">push</span><span class="p">()</span>
<span class="c1">// pushed ..</span>
<span class="c1">// state: closed</span>
</code></pre></div></div>

<blockquote>
  <p>note: <code>hooks</code> are not serialised so they must be passed again when reviving, <br />
as shown above.</p>
</blockquote>

<h2 id="fsm-as-a-mixin">FSM as a <code>mixin</code></h2>

<p>Passing an <code>Object</code> as <code>hooks</code> to: <code>fsm(states, hooks)</code> assigns FSM behaviour <br />
on the provided object.</p>

<p>Useful in cases where an object must function as an FSM, in addition to some <br />
other behaviour.<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote" rel="footnote">3</a></sup></p>

<blockquote>
  <p>example: A <code>Turnstile</code> functioning as both an <a href="https://nodejs.org/docs/latest/api/events.html#class-eventemitter"><code>EventEmitter</code></a> &amp; an <code>FSM</code></p>
</blockquote>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Turnstile</span> <span class="kd">extends</span> <span class="nc">EventEmitter</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="p">()</span>

    <span class="nf">fsm</span><span class="p">({</span>
      <span class="na">closed</span><span class="p">:</span> <span class="p">{</span> <span class="na">coin</span><span class="p">:</span> <span class="dl">'</span><span class="s1">opened</span><span class="dl">'</span> <span class="p">},</span>
      <span class="na">opened</span><span class="p">:</span> <span class="p">{</span> <span class="na">push</span><span class="p">:</span> <span class="dl">'</span><span class="s1">closed</span><span class="dl">'</span> <span class="p">}</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">turnstile</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Turnstile</span><span class="p">()</span>

<span class="c1">// works as EventEmitter.</span>

<span class="nx">turnstile</span><span class="p">.</span><span class="nf">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">)</span>

<span class="c1">// works as an FSM as well.</span>

<span class="nx">turnstile</span><span class="p">.</span><span class="nf">coin</span><span class="p">()</span>

<span class="c1">// state: opened</span>
</code></pre></div></div>

<blockquote>
  <p>this concept is similar to a <a href="https://developer.mozilla.org/en-US/docs/Glossary/Mixin"><code>mixin</code></a>.</p>
</blockquote>

<h2 id="api-1">API</h2>

<h3 id="fsmstates-hooks"><code>fsm(states, hooks)</code></h3>

<p>Construct an <code>FSM</code></p>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>type</th>
      <th>desc.</th>
      <th>default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>states</code></td>
      <td><code>object</code></td>
      <td>a <a href="https://en.wikipedia.org/wiki/State-transition_table">state-transition table</a></td>
      <td>required</td>
    </tr>
    <tr>
      <td><code>hooks</code></td>
      <td><code>object</code></td>
      <td>implements transition hooks</td>
      <td><code>this</code></td>
    </tr>
  </tbody>
</table>

<p><code>states</code> must have the following abstract shape:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">state</span><span class="p">:</span> <span class="p">{</span> 
  <span class="nl">transition</span><span class="p">:</span> <span class="dl">'</span><span class="s1">next-state</span><span class="dl">'</span><span class="p">,</span>
  <span class="nx">transition</span><span class="p">:</span> <span class="dl">'</span><span class="s1">next-state</span><span class="dl">'</span> 
<span class="p">},</span>
<span class="nx">state</span><span class="p">:</span> <span class="p">{</span> <span class="nl">transition</span><span class="p">:</span> <span class="dl">'</span><span class="s1">next-state</span><span class="dl">'</span> <span class="p">}</span>
</code></pre></div></div>

<ul>
  <li>The 1st state in <code>states</code> is set as the <em>initial</em> state.</li>
  <li>Each <code>state</code> can list zero, one or many transitions.</li>
  <li>The <code>next-state</code> must exist as a <code>state</code>.</li>
</ul>

<h3 id="fsmjson-hooks"><code>fsm(json, hooks)</code></h3>

<p>Revive an instance from it’s <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON">JSON</a>.</p>

<h4 id="arguments">Arguments</h4>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>type</th>
      <th>desc.</th>
      <th>default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>json</code></td>
      <td><code>string</code></td>
      <td><code>JSON.stringify(fsm)</code> result</td>
      <td>required</td>
    </tr>
  </tbody>
</table>

<h3 id="fsmstate"><code>fsm.state</code></h3>

<p>The current <code>state</code>. Read-only.</p>

<table>
  <thead>
    <tr>
      <th>name</th>
      <th>type</th>
      <th>default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>state</code></td>
      <td><code>string</code></td>
      <td>current state</td>
    </tr>
  </tbody>
</table>

<h2 id="tests">Tests</h2>

<blockquote>
  <p>unit tests:</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>node <span class="nt">--run</span> <span class="nb">test</span>
</code></pre></div></div>

<blockquote>
  <p>these tests <em>require</em> that certain <a href="https://github.com/nicholaswmin/fsm/blob/main/package.json#L11">coverage thresholds</a> are met.</p>
</blockquote>

<h2 id="contributing">Contributing</h2>

<p><a href="https://github.com/nicholaswmin/fsm/blob/main/.github/CONTRIBUTING.md">Contribution Guide</a></p>

<h2 id="publishing">Publishing</h2>

<ul>
  <li>collect all changes in a pull-request</li>
  <li>merge to <code>main</code> when all ok</li>
</ul>

<p>then from a clean <code>main</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># list current releases</span>
gh release list
</code></pre></div></div>

<p>Choose the next <a href="https://semver.org/">Semver</a>, i.e: <code>1.3.1</code>, then:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gh release create 1.3.1
</code></pre></div></div>

<blockquote>
  <p><strong>note:</strong> dont prefix releases/tags with <code>v</code>, just <code>x.x.x</code> is enough.</p>
</blockquote>

<p>The Github release triggers the <a href="https://github.com/nicholaswmin/fsm/actions/workflows/npm:publish.yml"><code>npm:publish workflow</code></a>,  <br />
publishing the new version to <a href="https://www.npmjs.com/package/@nicholaswmin/fsm">npm</a>.</p>

<p>It then attaches a <a href="https://docs.npmjs.com/generating-provenance-statements/">Build Provenance</a> statement on the <br />
<a href="https://github.com/nicholaswmin/fsm/releases/latest">Release Notes</a>.</p>

<p>That’s all.</p>

<h2 id="authors">Authors</h2>

<p><a href="https://github.com/nicholaswmin">N.Kyriakides; @nicholaswmin</a></p>

<h2 id="license">License</h2>

<p>The <a href="https://raw.githubusercontent.com/nicholaswmin/fsm/refs/heads/main/LICENSE">MIT License</a></p>

<h3 id="footnotes">Footnotes</h3>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>A finite-state machine can only exist in <em>one</em> and <em>always-valid</em> state.  
  It requires declaring all possible states &amp; the rules under which it can 
  transition from one state to another. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:2" role="doc-endnote">
      <p>A function that accepts an infinite number of arguments.   
  Also called: functions of <em>“n-arity”</em> where “arity” = number of arguments.</p>

      <p>i.e: nullary: <code>f = () =&gt; {}</code>, unary: <code>f = x =&gt; {}</code>,
  binary: <code>f = (x, y) =&gt; {}</code>, ternary <code>f = (a,b,c) =&gt; {}</code>, 
  n-ary/variadic: <code>f = (...args) =&gt; {}</code> <a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:3" role="doc-endnote">
      <p>FSMs are rare but perfect candidates for <em>inheritance</em> because usually
  something <code>is-an</code> FSM.  
  However, Javascript doesn’t support <em>multiple inheritance</em> so inheriting 
  <code>FSM</code> would create issues when inheriting other behaviours.</p>

      <p><em>Composition</em> is also problematic since it namespaces the behaviour, 
  causing it to lose it’s expressiveness.  
  i.e <code>light.fsm.turnOn</code> feels misplaced compared to <code>light.turnOn</code>. <a href="#fnref:3" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>
</main>
<footer role="contentinfo">
  <ul id="menu">
  <li><a href="/">posts</a></li>
  <li><a href="/cv">author</a></li>
  </ul>

  <small> 
    <a href="https://en.wikipedia.org/wiki/Agnes_Martin"> 
     > 29895 bytes
    </a>
  </small>
</footer>
<link rel="stylesheet" href="/public/highlight.css"><link>